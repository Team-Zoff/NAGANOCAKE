<%# viewで必要な計算 %>
<% total = 0 %>
<% postage = @order_detail.order.shipping_free %>
<% @order_detail.each do |order_detail| %>
  <% order_detail.product.price_excluding_tax %>
  <% order_detail.purchase_quantity %>
  <% subtotal = order_detail.product.price_excluding_tax * order_detail.purchase_quantity %>
  <% total = total + subtotal %>
<% end %>

<%# view画面 %>
<div class="row">
  <h2>注文履歴詳細</h2>
  <div class="col-xs-6">
    <h4>注文情報</h4>
    <table>
      <thead>
        <tr>
          <th>注文日</th><th><%= @order_detail.order.created_at %></th>
        </tr>
        <tr>
          <th>配送先</th>
          <th><%= @order_detail.order.postal_code %><br>
            <%= @order_detail.order.address %><br>
            <%= @order_detail.order.address_name %>
          </th>
        </tr>
        <tr>
          <th>支払方法</th><th><%= @order_detail.order.method_of_payment %></th>
        </tr>
        <tr>
          <th>ステータス</th><th><%= @order_detail.order.order_status %></th>
        </tr>
      </thead>
    </table>
  </div>
  <div class="col-xs-6">
    <h4>請求情報</h4>
    <table>
      <thead>
        <tr>
          <th>商品の合計</th><th><%= total %></th>
        </tr>
        <tr>
          <th>配送料</th><th><%= postage %></th>
        </tr>
        <tr>
          <th>ご請求額</th><th><%= total + postage %></th>
        </tr>
      </thead>
    </table>
  </div>
</div>
<div class="row">
  <div>
    <h4>注文内容</h4>
    <table>
      <thead>
        <tr>
          <th>商品</th><th>単価(税込み)</th><th>個数</th><th>小計</th>
        </tr>
      </thead>
      <tbody>
        <% total = 0 %>
        <% @order_detail.each do |order_detail| %>
        <tr>
          <td>
            <%= order_detail.product.name %>
          </td>
          <td>
            <%= order_detail.product.price_excluding_tax * 1.10 %>
          </td>
          <td>
            <%= order_detail.purchase_quantity %>
          </td>
          <td>
            <%= subtotal = order_detail.product.price_excluding_tax * order_detail.purchase_quantity %>
            <% total = total + subtotal %>
          </td>
        </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
